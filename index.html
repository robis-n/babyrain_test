<!DOCTYPE html>
<html>
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-56C2P7FCRD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-56C2P7FCRD');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>babyrain — Homepage</title>
    <meta name="description" content="This is the very first English pre-university student essay publication in the Baltics!">
    <link rel="icon" type="image/x-icon" href="./logo_babyrain.png">
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://use.typekit.net/yqn2qxq.css">

    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/nav.css">
    
    <script src="./js/nav.js"></script>
</head>
<body>
    <nav class="nav" id="nav">
        <div class="nav__logo">
            <a href="./">BABYRAIN</a>
        </div>
        <div id="mainListDiv" class="main_list nav__wrapper">
            <ul class="navlinks nav__wrapper__list">
                <li class="nav__wrapper__list__item"><a href="./">Writing</a></li>
                <li class="nav__wrapper__list__item"><a href="./about">About</a></li>
                <li class="nav__wrapper__list__item"><a href="./apply">Apply</a></li>
            </ul>
        </div>
        <span class="navTrigger nav__toggle-btn">
            <i></i>
            <i></i>
            <i></i>
        </span>
    </nav>
    <div class="layout-container">
        <div class="title-page">
            <h1 class="title-text">essays</h1>
            <h3>&nbspjanuary 18 • place</h3>
        </div>

        <div class="column">
            <h2 class="title"><a href="./essays/we-drink-our-coffee-and-avoid-eye-contact">We drink our coffee and avoid eye contact</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob1"></div>
                <div class="text-content">
                    <p>
                        On the corner of Dzirnavu and Baznīcas Street is a unit of a café franchise. Floor-to-ceiling windows with warm-toned plastic fairy lights draping down, Picasso and Matisse rejects hung on insipid sage walls, a haphazard bookshelf, various artificial plants...
                    </p>
                </div>
            </div>
        </div>
        <div class="column">
            <h2 class="title"><a href="./essays/No-One-Writes-to-the-Supervisor">No One Writes to the Supervisor</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob2"></div>
                <div class="text-content">
                    <p>
                        My girl was not magic. She was not a six-legged spider hanging off the side of a mountain, nor a Russian poet who wrote her best work in the company of Siberian rats...
                    </p>
                </div>
            </div>
        </div>
        <div class="column">
            <h2 class="title"><a href="./essays/Grains-of-Sand-and-Sunshine">Grains of Sand and Sunshine</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob3"></div>
                <div class="text-content">
                    <p>
                        The tickling my mom inflicts on me feels stress-free when the sun joins in. On the three stories of our summer house, I feel human. I feared life when the last local cat first sat on my lap and refused to go, and I loved my ears every time I heard...
                    </p>
                </div>
            </div>
        </div>
        <div class="column">
            <h2 class="title"><a href="./essays/A-house-to-worship">A house to worship.</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob4"></div>
                <div class="text-content">
                    <p>
                        It’s humid. Our skin sticks to each other's arms and the yellow curtains are failing to dwindle the intensity of the sun. It must’ve been around 3 pm, hour 4 in the back of this bus, destined for a remote and almost vacant childhood town, when we finally took...
                    </p>
                </div>
            </div>
        </div>
        <div class="column">
            <h2 class="title"><a href="./essays/hush">Hush</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob5"></div>
                <div class="text-content">
                    <p>
                        A small village called Pitrags (or <span style="font-style: italic;">Pitrõg</span> in its original Livonian) stands in Courland nestled against the rolling sea and ambrosial trees. It is my family’s <span style="font-style: italic;">summer</span> home — in truth, many snow-laced days have...
                    </p>
                </div>
            </div>
        </div>
        <div class="column">
            <h2 class="title"><a href="./essays/the-lighthouse">The Lighthouse</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob6"></div>
                <div class="text-content">
                    <p>
                        A short horror story inspired by the disappearances of James Ducat, Thomas Marshall and Donald McArthur while on duty on the Flannan Isles lighthouse.
                    </p>
                </div>
            </div>
        </div>
        <div class="column">
            <h2 class="title"><a href="./essays/my-grandparents">My Grandparents’</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob7"></div>
                <div class="text-content">
                    <p>
                        If I could, only for a mere second, go to that place that no longer stands as it once stood, as it should. A place that exists in my mind, where only memories prevail: my grandparents'...
                    </p>
                </div>
            </div>
        </div>

        <div class="title-page">
            <h1 class="title-text">essays</h1>
            <h3>&nbspnovember 9</h3>
        </div>
        <div class="column">
            <h2 class="title"><a href="./essays/choice">Choice</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob8"></div>
                <div class="text-content">
                    <p>I step forward, and the automatic doors open. Fluorescent lights beam overhead. Towering shelves frame my field of view as I slowly peruse each aisle. <span class="blob-placeholder"></span> Mascots on cereal boxes, meticulously written nutritional contents and allergen warnings, stickers highlighting...</p>
                </div>
            </div>
        </div>

        <div class="column">
            <h2 class="title"><a href="./essays/when-the-tears-start-to-curdle">When the tears start to curdle.</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob9"></div>
                <div class="text-content">
                    <p style="font-style: italic;">There is blankness in place of memories. There is nothing in spots where something should be, not even a hint or glimpse. <span class="blob-placeholder"></span> I have never been able to grasp that nothingness, and I have never been able to make sense of it. All the years and dates mentioned are approximations. I am still determining how close or far apart most of these events occurred...</p>
                </div>
            </div>
        </div>

        <div class="column">
            <h2 class="title"><a href="./essays/all-of-a-sudden-everybody-was-laughing-at-me">All of a sudden everybody was laughing at me.</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob10"></div>
                <div class="text-content">
                    <p>Comedy is like magic. It's like a magician showing tricks to a little boy - the magician hopes he falls for it and the boy hopes to not expect what's about to happen. I don't think there exists a good joke where the comic played on the expected - that's not comedy, it's formality...</p>
                </div>
            </div>
        </div>

        <div class="column">
            <h2 class="title"><a href="./essays/the-week-felt-like-there-was-a-full-moon">The week felt like there was a full moon.</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob11"></div>
                <div class="text-content">
                    <p>I have submitted my first college application. I fail to reflect on the fact and recognize its significance after two years of anticipation. I have a week to submit my portfolio, and another two until my interview, and then another month until a decision. Maybe then I will have understood…</p>
                </div>
            </div>
        </div>

        <div class="column">
            <h2 class="title"><a href="./essays/home">Home</a></h2>
            <div class="blob-wrapper">
                <div class="blob-container blob" id="blob12"></div>
                <div class="text-content">
                    <p>“Bliny?” Despite this memory being well over a decade old, I distinctly remember the teaching assistant’s soft-spoken inquiry encouraging me to speak. I had spent the previous hours meticulously rolling out clay on my small part of the table, afraid and unable to socialise. It was my first day at school…</p>
                </div>
            </div>
        </div>
        <footer class="footer">
            <div class="footer__content">
                <span><img src="./instagram.png"
                    alt="instagram"><a href="https://www.instagram.com/babywritesrain?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="><p class="baywritesrain">babywritesrain</p></a></span>
                <a href="tel:+37129339415">+371 29339415</a>
                <a href="mailto:braarmarr@gmail.com">braarmarr@gmail.com</a>
            </div>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="js/MorphingBlob.js"></script>
    <script>
        const activeBlobs = new Map();
        const MAX_CONTEXTS = 6; // Increase from 4 to 6
        const CHUNK_DELAY = 500; // Decrease from 1000 to 500
        let contextCount = 0;
        const colors = [
            new THREE.Color(0.8, 0.8, 0.5),
            new THREE.Color(0.9, 0.6, 0.6),
            new THREE.Color(1, 0.9, 0.9)
        ];

        function createFallbackBlob(container, color) {
            const fallback = document.createElement('div');
            fallback.style.width = '100%';
            fallback.style.height = '100%';
            fallback.style.background = `radial-gradient(circle at 30% 30%, 
                rgba(${color.r * 255}, ${color.g * 255}, ${color.b * 255}, 0.8),
                rgba(${color.r * 255}, ${color.g * 255}, ${color.b * 255}, 0.3))`;
            fallback.style.borderRadius = '50%';
            fallback.style.animation = 'pulse 4s infinite';
            container.innerHTML = '';
            container.appendChild(fallback);
        }

        function getBlobSize() {
            const width = window.innerWidth;
            let size;
            
            if (width <= 927) {
                // Mobile: single column
                size = Math.min(width - 32, 500);
            } else if (width >= 1200) {
                // Tablet: two columns
                size = Math.min((width - 96) / 2, 500);
            } else {
                // Desktop: three columns
                size = Math.min((width - 96) / 2, 500);
            }
            
            return { 
                width: size,
                height: size // Make it square
            };
        }

        function initializeBlobs() {
            // Clean up existing blobs
            activeBlobs.forEach(blob => blob.dispose());
            activeBlobs.clear();
            contextCount = 0;

            const size = getBlobSize();
            const isAndroid = /Android/i.test(navigator.userAgent);
            
            // Update wrapper heights
            document.querySelectorAll('.blob-wrapper').forEach(wrapper => {
                wrapper.style.height = `${size.height}px`;
            });

            // Process blobs in smaller chunks
            const blobElements = Array.from(document.querySelectorAll('.blob'));
            const chunkSize = isAndroid ? 2 : Math.min(6, MAX_CONTEXTS); // Increase chunk size

            function loadChunk(startIndex) {
                if (startIndex >= blobElements.length || contextCount >= MAX_CONTEXTS) return;

                const endIndex = Math.min(startIndex + chunkSize, blobElements.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    if (contextCount >= MAX_CONTEXTS) break;
                    
                    const blob = blobElements[i];
                    if (!blob || activeBlobs.has(blob.id)) continue;

                    try {
                        const blobInstance = new MorphingBlob(blob.id, {
                            size: size,
                            amplitude: isAndroid ? 0.05 : 0.25,
                            frequency: isAndroid ? 0.2 : 0.4,
                            density: isAndroid ? 1.2 : 2.5,
                            strength: isAndroid ? 0.05 : 0.2,
                            radius: isAndroid ? 1.0 : 2.0,
                            detail: isAndroid ? 1 : 4,
                            color: new THREE.Color(0.8, 0.8, 0.5)
                        });
                        
                        activeBlobs.set(blob.id, blobInstance);
                        contextCount++;
                    } catch (error) {
                        console.error(`Failed to create blob ${i}:`, error);
                        createFallbackBlob(blob);
                    }
                }

                // Schedule next chunk with increased delay
                if (endIndex < blobElements.length && contextCount < MAX_CONTEXTS) {
                    setTimeout(() => loadChunk(endIndex), CHUNK_DELAY);
                }
            }

            loadChunk(0);
        }

        // Make elements visible with a delay
        function makeVisible() {
            document.querySelectorAll('.column').forEach((column, index) => {
                setTimeout(() => {
                    column.classList.add('visible');
                    column.querySelector('.blob-container').classList.add('visible');
                    column.querySelector('.text-content').classList.add('visible');
                }, index * 200);
            });
        }

        // Initialize and make visible when page loads
        window.addEventListener('load', () => {
            // Small delay to ensure content is properly laid out
            setTimeout(() => {
                initializeBlobs();
                makeVisible();
                // Reattach observers after initialization
                document.querySelectorAll('.column').forEach(column => {
                    visibilityObserver.observe(column);
                });
            }, 100);
        });

        // Reinitialize blobs when window is resized
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Clean up old blobs properly
                activeBlobs.forEach(blob => {
                    blob.dispose();
                });
                activeBlobs.clear();
                
                // Reinitialize with new size
                initializeBlobs();
            }, 250); // Debounce resize events
        });

        // Clean up when leaving page
        window.addEventListener('beforeunload', () => {
            activeBlobs.forEach(blob => {
                blob.dispose();
            });
            activeBlobs.clear();
        });

        // Add this function before the visibility observer
        function initializeBlob(container, index) {
            const size = getBlobSize();
            const isAndroid = /Android/i.test(navigator.userAgent);
            
            // Check if we're at the context limit
            if (contextCount >= MAX_CONTEXTS) {
                // Remove oldest blob
                const oldestId = Array.from(activeBlobs.keys())[0];
                if (oldestId) {
                    const oldBlob = activeBlobs.get(oldestId);
                    oldBlob.dispose();
                    activeBlobs.delete(oldestId);
                    contextCount--;
                }
            }

            try {
                const blobElement = container.querySelector('.blob');
                const commonConfig = {
                    size: size,
                    amplitude: isAndroid ? 0.05 : 0.25,
                    frequency: isAndroid ? 0.2 : 0.4,
                    density: isAndroid ? 1.2 : 2.5,
                    strength: isAndroid ? 0.05 : 0.2,
                    radius: isAndroid ? 1.0 : 2.0,
                    detail: isAndroid ? 1 : 4,
                    color: new THREE.Color(
                        0.8 + (index * 0.1) % 0.3,
                        0.6 + (index * 0.1) % 0.3,
                        0.6 + (index * 0.1) % 0.3
                    )
                };

                const blobInstance = new MorphingBlob(blobElement.id, commonConfig);
                activeBlobs.set(blobElement.id, blobInstance);
                contextCount++;
            } catch (error) {
                console.error(`Failed to initialize blob ${index}:`, error);
                createFallbackBlob(container, colors[index % colors.length]);
            }
        }

        // Update the visibility observer
        const visibilityObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const blobContainer = entry.target;
                const blobElement = blobContainer.querySelector('.blob');
                if (!blobElement) return;

                const blobId = blobElement.id;
                const blob = activeBlobs.get(blobId);
                const index = parseInt(blobId.replace('blob', '')) - 1;
                
                if (entry.isIntersecting) {
                    if (!blob || blob.isDisposed) {
                        // Only create new blob if we're under the context limit
                        if (contextCount < MAX_CONTEXTS) {
                            initializeBlob(blobContainer, index);
                        }
                    }
                } else if (blob) {
                    // Dispose blob when not visible
                    blob.dispose();
                    activeBlobs.delete(blobId);
                    contextCount--;
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '100px'
        });

        // Add observer attachment
        document.querySelectorAll('.column').forEach(column => {
            visibilityObserver.observe(column);
        });
    </script>
</body>
</html>
